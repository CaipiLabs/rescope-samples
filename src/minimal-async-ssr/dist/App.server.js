/*!
 * MIT License
 * 
 * Copyright (c) 2018 Wise Wild Web
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=4)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("shortid")},function(e,t){e.exports=require("rscopes")},function(e,t){e.exports=require("react-dom/server")},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0});var a=c(r(0)),o=c(r(1)),l=c(r(5)),s=r(2),u=r(3);function c(e){return e&&e.__esModule?e:{default:e}}r(8);var d=r(9),p=r(10),f=(i=n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},n.renderTo=function(e,t){var r=new s.Scope(l.default,{id:"App"}),n=(d.parse(document.cookie)||{})["connect.sid"];n=n&&n.replace(/^s\:([^\.]+)(?:$|\..*$)/gi,"$1"),window.scopes=s.Scope.scopes,window.test=function(){f.renderSSR({state:r.serialize(),sessionId:n},function(e,t){return console.log(t)})},t&&r.restore(t),r.mount(["Home"]).then(function(t){var r=t.Home;p.hydrate(a.default.createElement(r,{sessionId:n}),e)})},n.renderSSR=function(e,t){var r=o.default.generate(),n=new s.Scope(l.default,{id:r});n.mount(["SSRIndex"]).then(function(e){(0,u.renderToString)(a.default.createElement(e.SSRIndex,{appScope:n})),n.then(function(e){var r=(0,u.renderToString)(a.default.createElement(e.SSRIndex,{appScope:n}));t(null,r),n.destroy()})})},i);"undefined"!=typeof window&&(window.App=f),t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i,a,o,l,s,u,c,d,p,f,m,S,h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v=x(r(0)),b=x(r(6)),y=x(r(1)),g=x(r(7)),w=x(r(2));r(3);function x(e){return e&&e.__esModule?e:{default:e}}function P(e,t,r,n,i){var a={};return Object.keys(n).forEach(function(e){a[e]=n[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}var I=w.default.spells,O=I.asStateMap,z=I.asScope,_=I.asRenderer;I.asRootRenderer;t.default=(n=_(["!Home"]),i=_(["!AppState.appState","!AppState.someData","!PostIt"]),a=_((P(o={DaSearch:{src:"https://query.yahooapis.com/v1/public/yql?format=json&env=sto&q=",updateSearch:function(e){var t=this,r=this.nextState;if(e!=r.searching)return e.length<4?{searching:e}:(this.wait(),b.default.get(r.src+'select * from weather.forecast where woeid in (select woeid from geo.places(1) where text="'+e+'")').then(function(r){if(e==t.nextState.searching){try{t.data.results={place:r.body.query.results.channel.location,img:r.body.query.results.channel.image.url,descr:r.body.query.results.channel.item.description.replace("<![CDATA[","").replace("]]>","")}}catch(e){t.data.results={place:{city:"no results"}}}t.push(t.data),t.release()}}),{searching:e})}}},"DaSearch",[O],(l=(l=Object.getOwnPropertyDescriptor(o,"DaSearch"))?l.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return l}}),o),o),["DaSearch"]),P(s={AppState:(f={appState:{selectedPostItId:null,selectPostIt:function(e){return{selectedPostItId:e}}},someData:{src:"/api/hello",items:[{_id:"rkUQHZrqM",size:{width:300,height:400},text:"New Post It #0 somewhere we wait some new shit out there !",position:{x:321,y:167}},{_id:"r1bcuMrcM",size:{width:300,height:400},text:"do somethink",position:{x:260,y:576}}],newPostIt:function(){return{items:[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(this.nextState.items),[{_id:y.default.generate(),size:{width:200,height:200},position:{x:100+~~(600*Math.random()),y:100+~~(600*Math.random())},text:"New Post It #"+this.nextState.items.length}])}},updatePostIt:function(e){return{items:this.nextState.items.map(function(t){return t._id===e._id?e:t})}},rmPostIt:function(e){return{items:this.nextState.items.filter(function(t){return t._id!==e._id})}},saveState:function(){b.default.post("/",window.state=this.$stores.$parent.serialize({norefs:!0})).then(function(e,t){console.log(e,t)})}}},P(f,"appState",[O],(m=Object.getOwnPropertyDescriptor(f,"appState"),m=m?m.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return m}}),f),P(f,"someData",[O],(S=Object.getOwnPropertyDescriptor(f,"someData"),S=S?S.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return S}}),f),f),SSRIndex:function(e,t){var r=e.Home,n=e.props,i=(n.sessionId,n.appScope);t.$scope;return v.default.createElement("html",{lang:"en"},v.default.createElement("head",null,v.default.createElement("meta",{charSet:"UTF-8"}),v.default.createElement("title",null,"Really basic drafty rescope + react SSR example")),v.default.createElement("body",null,v.default.createElement("div",{id:"app"},v.default.createElement(r,null)),v.default.createElement("script",{src:"./App.js"}),v.default.createElement("script",{dangerouslySetInnerHTML:{__html:"App.renderTo(document.getElementById('app'), "+JSON.stringify(i.serialize({norefs:!0,alias:"App"}))+", document.cookie);"}})))},Home:function(e,t){var r=e.someData,n=e.appState,i=e.PostIt,a=t.$actions,o=(t.$stores,t.$scope);return v.default.createElement("div",null,v.default.createElement("h1",null,"Really basic drafty rescope SSR example"),v.default.createElement("div",{className:"newBtn button",onClick:a.AppState.newPostIt},"Add Post It"),v.default.createElement("div",{className:"saveBtn button",onClick:a.AppState.saveState},"Save state"),v.default.createElement("pre",null,JSON.stringify(o.parent.parent.serialize({norefs:!0,alias:"App"}),null,2)),r.items.map(function(e){return v.default.createElement(i,{key:e._id,record:e,onSelect:function(t){return a.AppState.selectPostIt(e._id)},selected:e._id==n.selectedPostItId})}))},PostIt:function(e,t){var r=e.props,n=r.record,i=r.onSelect,a=r.selected,o=e.position,l=(e.text,e.size),s=(e.editing,e.DaSearch),u=e.doSave,c=void 0===u?function(){return d.AppState.updatePostIt(h({},n,{size:l||n.size,position:o}))}:u,d=t.$actions,p=(t.$stores,t.$store);return v.default.createElement(g.default,{absolutePos:!0,z:a?2e3:1,size:l||n.size,position:o||n.position,onDragStop:c,onResizeStop:c,onDrag:function(e,t){!a&&i(n),p.setState({position:{x:t.x,y:t.y}})},onResize:function(e,t,r,n,i){p.setState({position:i,size:{width:r.offsetWidth,height:r.offsetHeight}})}},v.default.createElement("div",{className:"postit handle"},v.default.createElement("div",{className:"search"},v.default.createElement("input",{onChange:function(e){d.updateSearch(e.target.value)},onMouseDown:function(e){return e.stopPropagation()}})),s&&s.results&&s.results.place&&v.default.createElement("div",null,s.results.place.city," - ",s.results.place.country),v.default.createElement("div",{className:"text",dangerouslySetInnerHTML:{__html:s&&s.results&&s.results.descr}})))}},"AppState",[z],(u=(u=Object.getOwnPropertyDescriptor(s,"AppState"))?u.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return u}}),s),P(s,"SSRIndex",[n],(c=(c=Object.getOwnPropertyDescriptor(s,"SSRIndex"))?c.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return c}}),s),P(s,"Home",[i],(d=(d=Object.getOwnPropertyDescriptor(s,"Home"))?d.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return d}}),s),P(s,"PostIt",[a],(p=(p=Object.getOwnPropertyDescriptor(s,"PostIt"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),s),s)},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("react-rnd")},function(e,t){},function(e,t){e.exports=require("cookie")},function(e,t){e.exports=require("react-dom")}]);
//# sourceMappingURL=App.server.js.map